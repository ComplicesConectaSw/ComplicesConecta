import{an as K,y as W,u as Y,r as d,au as i,j as e,o as C,B as b,A as Z,C as m,a as h,b as u,U as D,d as x,O as P,at as ee,q as se,T as te,t as ae,v as N,aj as re,x as v,l as y,I as ie}from"./index-1rAgi2Qg.js";import{T as ne}from"./textarea-D_hiNBb5.js";import{C as ce}from"./chart-column-Bv2OHn9E.js";import{M as oe}from"./message-square-Vq01sBCb.js";import{C as le}from"./circle-x-bArO6o-C.js";import{T as de}from"./trash-2-C-UYuPTo.js";import{P as me}from"./plus-CRp-iFFZ.js";const _e=()=>{const{isAdmin:I,isAuthenticated:R}=K(),{toast:n}=W(),p=Y(),[w,_]=d.useState([]),[l,F]=d.useState({totalUsers:0,activeUsers:0,premiumUsers:0,totalMatches:0,apkDownloads:0,dailyVisits:0,totalTokens:0,stakedTokens:0,worldIdVerified:0,rewardsDistributed:0}),[S,g]=d.useState([]),[V,k]=d.useState([]),[M,E]=d.useState(!0),[he,ue]=d.useState(null),[c,j]=d.useState({question:"",answer:"",category:"general"}),[xe,pe]=d.useState(null);d.useEffect(()=>{console.log("üîÑ AdminProduction - Verificando acceso...");const s=localStorage.getItem("demo_authenticated"),a=localStorage.getItem("demo_user");if(s==="true"&&a)try{const r=JSON.parse(a);if(console.log("üé≠ Usuario demo detectado:",r.email,"Role:",r.role),r.accountType==="admin"||r.role==="admin"){console.log("‚úÖ Admin demo autorizado - cargando panel producci√≥n"),setTimeout(()=>{U()},100);return}else{console.log("‚ùå Usuario demo sin permisos admin"),n({title:"Acceso Denegado",description:"No tienes permisos de administrador",variant:"destructive"}),p("/discover");return}}catch(r){console.error("‚ùå Error parsing demo user:",r),p("/auth");return}setTimeout(()=>{const r=R();if(console.log("üîê Estado autenticaci√≥n:",r),!r){console.log("‚ùå No autenticado - redirigiendo a /auth"),n({title:"Acceso Denegado",description:"Debe iniciar sesi√≥n para acceder al panel de administraci√≥n",variant:"destructive"}),p("/auth");return}const t=I();if(console.log("üëë Estado admin:",t),!t){console.log("‚ùå Usuario sin permisos admin - redirigiendo a /discover"),n({title:"Acceso Denegado",description:"No tiene permisos de administrador",variant:"destructive"}),p("/discover");return}console.log("‚úÖ Acceso autorizado - cargando panel producci√≥n"),U()},200)},[p,n]);const U=async()=>{E(!0);try{await Promise.all([Q(),L(),z(),O()])}catch(s){console.error("Error loading production admin data:",s),n({title:"Error",description:"Error al cargar datos del panel de administraci√≥n de producci√≥n",variant:"destructive"})}finally{E(!1)}},Q=async()=>{try{const{data:s,error:a}=await i.from("profiles").select("*").order("created_at",{ascending:!1}).limit(100);if(a){console.error("Error loading profiles:",a);return}const r=(s||[]).map(t=>({id:t.id,display_name:`${t.first_name} ${t.last_name}`,first_name:t.first_name,last_name:t.last_name,age:t.age,location:t.bio||"No especificada",email:"No disponible",is_verified:t.is_verified||!1,gender:t.gender,interested_in:t.interested_in,is_premium:t.is_premium||!1,created_at:t.created_at,last_seen:"Nunca",avatar_url:"",bio:t.bio||"Sin biograf√≠a",relationship_type:"single"}));_(r)}catch(s){console.error("Error in loadRealProfiles:",s)}},L=async()=>{try{const[{count:s},{count:a},{count:r},{count:t}]=await Promise.all([i.from("profiles").select("*",{count:"exact",head:!0}),i.from("profiles").select("*",{count:"exact",head:!0}).eq("is_premium",!0),i.from("profiles").select("*",{count:"exact",head:!0}).eq("is_verified",!0),i.from("chat_invitations").select("*",{count:"exact",head:!0})]);let A={count:0},T=null,q=null;try{A={count:(await i.from("apk_downloads").select("*",{count:"exact",head:!0})).count||0}}catch{console.log("‚ö†Ô∏è Tabla apk_downloads no disponible")}try{const o=await i.from("app_metrics").select("*");o.error||(T=o.data)}catch{console.log("üìä Tabla app_metrics no disponible, usando datos calculados")}try{const o=await i.from("user_token_balances").select("cmpx_balance");o.error||(q=o.data)}catch{console.log("ü™ô Tabla user_token_balances no disponible")}const f=o=>T&&T.find(J=>J.metric_name===o)?.metric_value||0,H=q?.length||0,X=f("staked_tokens");console.log("üìä Estad√≠sticas cargadas:",{totalUsers:s||0,premiumUsers:a||0,verifiedUsers:r||0,apkDownloads:A.count||0}),F({totalUsers:s||0,activeUsers:Math.floor((s||0)*.7),premiumUsers:a||0,totalMatches:f("total_matches")||Math.floor((s||0)*.3),apkDownloads:A.count||0,dailyVisits:f("daily_visits")||Math.floor((s||0)*.4),totalTokens:H,stakedTokens:X||0,worldIdVerified:r||0,rewardsDistributed:f("rewards_distributed")||0})}catch(s){console.error("Error loading real stats:",s)}},z=async()=>{try{const{data:s,error:a}=await i.from("faq_items").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(a){console.log("üìã Tabla faq_items no disponible, usando lista vac√≠a"),g([]);return}const r=(s||[]).map(t=>({id:t.id,question:t.question,answer:t.answer,category:t.category||"general",created_at:t.created_at,updated_at:t.updated_at}));g(r),console.log("üìã FAQ items cargados:",r.length)}catch(s){console.log("üìã Error cargando FAQ, usando lista vac√≠a:",s),g([])}},O=async()=>{try{const{data:s,error:a}=await i.from("chat_invitations").select("*").order("created_at",{ascending:!1}).limit(50);if(a){console.error("Error loading invitations:",a),k([]);return}const r=(s||[]).map(t=>({id:t.id,from_profile:t.from_profile||"unknown",to_profile:t.to_profile||"unknown",message:t.message||"Sin mensaje",type:t.type||"profile",status:t.status||"pending",created_at:t.created_at||new Date().toISOString()}));k(r),console.log("üìß Invitaciones cargadas:",r.length)}catch(s){console.error("Error loading invitations:",s),k([])}},$=async s=>{try{const{error:a}=await i.from("profiles").delete().eq("id",s);if(a)throw a;_(w.filter(r=>r.id!==s)),n({title:"Perfil Eliminado",description:"El perfil ha sido eliminado exitosamente"})}catch{n({title:"Error",description:"Error al eliminar el perfil",variant:"destructive"})}},G=async s=>{try{const a=w.find(t=>t.id===s);if(!a)return;const{error:r}=await i.from("profiles").update({is_premium:!a.is_premium}).eq("id",s);if(r)throw r;_(w.map(t=>t.id===s?{...t,is_premium:!t.is_premium}:t)),n({title:"Estado Premium Actualizado",description:`El usuario ${a.is_premium?"ya no es":"ahora es"} premium`})}catch{n({title:"Error",description:"Error al actualizar el estado premium",variant:"destructive"})}},B=async()=>{if(!c.question||!c.answer){n({title:"Error",description:"Debe completar la pregunta y respuesta",variant:"destructive"});return}try{const{data:s,error:a}=await i.from("faq_items").insert([{question:c.question,answer:c.answer,category:c.category}]).select().single();if(a)throw a;g([...S,{id:s.id,question:s.question,answer:s.answer,category:s.category||"general",created_at:s.created_at||new Date().toISOString(),updated_at:s.updated_at||new Date().toISOString()}]),j({question:"",answer:"",category:"general"}),n({title:"FAQ Agregada",description:"La pregunta frecuente ha sido agregada exitosamente"})}catch(s){console.error("Error adding FAQ:",s),n({title:"Error",description:"Error al agregar la pregunta frecuente",variant:"destructive"})}};return M?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[e.jsx(C,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-white text-xl",children:"Cargando panel de administraci√≥n..."})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[e.jsx(C,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(b,{variant:"outline",onClick:()=>p("/discover"),className:"text-white border-white/20 hover:bg-white/10",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Panel de Administraci√≥n - Producci√≥n"}),e.jsx("p",{className:"text-white/70",children:"Gesti√≥n completa de la plataforma ComplicesConecta"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-white",children:"Usuarios Totales"}),e.jsx(D,{className:"h-4 w-4 text-white"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.totalUsers}),e.jsx("p",{className:"text-xs text-white/70",children:"Usuarios registrados"})]})]}),e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-white",children:"Usuarios Premium"}),e.jsx(P,{className:"h-4 w-4 text-white"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.premiumUsers}),e.jsx("p",{className:"text-xs text-white/70",children:"Con suscripci√≥n activa"})]})]}),e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-white",children:"Descargas APK"}),e.jsx(ee,{className:"h-4 w-4 text-white"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.apkDownloads}),e.jsx("p",{className:"text-xs text-white/70",children:"Descargas totales"})]})]}),e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-white",children:"Verificados WorldID"}),e.jsx(se,{className:"h-4 w-4 text-white"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.worldIdVerified}),e.jsx("p",{className:"text-xs text-white/70",children:"Usuarios verificados"})]})]})]}),e.jsxs(te,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(ae,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsxs(N,{value:"users",className:"text-white data-[state=active]:bg-white/20",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Usuarios"]}),e.jsxs(N,{value:"stats",className:"text-white data-[state=active]:bg-white/20",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Estad√≠sticas"]}),e.jsxs(N,{value:"faq",className:"text-white data-[state=active]:bg-white/20",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"FAQ"]}),e.jsxs(N,{value:"invitations",className:"text-white data-[state=active]:bg-white/20",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Invitaciones"]})]}),e.jsx(v,{value:"users",className:"space-y-6",children:e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsx(h,{children:e.jsx(u,{className:"text-white",children:"Gesti√≥n de Usuarios"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:w.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:s.display_name?.charAt(0)||s.first_name?.charAt(0)||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.display_name||`${s.first_name} ${s.last_name}`||"Usuario sin nombre"}),e.jsx("p",{className:"text-white/60 text-sm",children:s.email}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[s.is_premium&&e.jsx(y,{variant:"secondary",children:"Premium"}),s.is_verified&&e.jsx(y,{variant:"outline",children:"Verificado"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>G(s.id),className:"text-white border-white/20 hover:bg-white/10",children:s.is_premium?e.jsx(le,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>$(s.id),children:e.jsx(de,{className:"w-4 h-4"})})]})]},s.id))})})]})}),e.jsx(v,{value:"faq",className:"space-y-6",children:e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsx(h,{children:e.jsx(u,{className:"text-white",children:"Gesti√≥n de FAQ"})}),e.jsxs(x,{children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ie,{placeholder:"Pregunta",value:c.question,onChange:s=>j({...c,question:s.target.value}),className:"bg-white/10 border-white/20 text-white placeholder-white/50"}),e.jsxs("select",{value:c.category,onChange:s=>j({...c,category:s.target.value}),className:"bg-white/10 border border-white/20 text-white rounded-md px-3 py-2",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"seguridad",children:"Seguridad"}),e.jsx("option",{value:"tokens",children:"Tokens"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsx(ne,{placeholder:"Respuesta",value:c.answer,onChange:s=>j({...c,answer:s.target.value}),className:"bg-white/10 border-white/20 text-white placeholder-white/50",rows:3}),e.jsxs(b,{onClick:B,className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Agregar FAQ"]})]}),e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsx("div",{className:"p-4 bg-white/5 rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-medium mb-2",children:s.question}),e.jsx("p",{className:"text-white/70 text-sm mb-2",children:s.answer}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.category||"general"})]})})},s.id))})]})]})}),e.jsx(v,{value:"stats",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsx(h,{children:e.jsx(u,{className:"text-white",children:"Tokens CMPX"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Total en circulaci√≥n:"}),e.jsx("span",{className:"text-white font-semibold",children:l.totalTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"En staking:"}),e.jsx("span",{className:"text-white font-semibold",children:l.stakedTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Recompensas distribuidas:"}),e.jsx("span",{className:"text-white font-semibold",children:l.rewardsDistributed.toLocaleString()})]})]})})]}),e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsx(h,{children:e.jsx(u,{className:"text-white",children:"Actividad"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Visitas diarias:"}),e.jsx("span",{className:"text-white font-semibold",children:l.dailyVisits})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Usuarios activos:"}),e.jsx("span",{className:"text-white font-semibold",children:l.activeUsers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/70",children:"Total matches:"}),e.jsx("span",{className:"text-white font-semibold",children:l.totalMatches})]})]})})]})]})}),e.jsx(v,{value:"invitations",className:"space-y-6",children:e.jsxs(m,{className:"bg-white/10 backdrop-blur-md border-white/20",children:[e.jsx(h,{children:e.jsx(u,{className:"text-white",children:"Invitaciones Recientes"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:V.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-medium",children:["Invitaci√≥n ",s.type]}),e.jsx("p",{className:"text-white/60 text-sm",children:s.message}),e.jsx("p",{className:"text-white/40 text-xs",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx(y,{variant:s.status==="accepted"?"default":s.status==="pending"?"secondary":"destructive",children:s.status})]},s.id))})})]})})]})]})]})};export{_e as default};
