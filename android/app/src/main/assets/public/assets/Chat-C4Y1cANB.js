import{u as I,r as i,j as e,B as l,A as g,T as O,t as $,v as k,w as m,l as M,G as b,x as P,I as z,s as L}from"./index-1rAgi2Qg.js";import{N as R}from"./Navigation-DRkFH7zH.js";import{u as B}from"./useFeatures-BfaxJA2a.js";import{m as U}from"./data-B29IFJau.js";import{i as G}from"./invitations-CuddF7zO.js";import{U as _}from"./user-plus-wrE-Be86.js";import{S as D}from"./send-BDvOtBRI.js";const X=()=>{const v=I(),{features:S}=B();i.useEffect(()=>{console.log("Chat demo cargado - acceso libre")},[v]);const[a,n]=i.useState(null),[T,w]=i.useState([]),[h,j]=i.useState(""),[f,p]=i.useState("private"),[N,y]=i.useState({}),x=s=>{w([{id:1,senderId:s,content:"¡Hola! ¿Cómo están?",timestamp:"10:30",type:"text"},{id:2,senderId:0,content:"¡Muy bien! ¿Y ustedes?",timestamp:"10:32",type:"text"},{id:3,senderId:s,content:"Genial, ¿les interesa conocernos mejor?",timestamp:"10:35",type:"text"}])};i.useEffect(()=>{(async()=>{const r={};for(const c of o)if(c.isPrivate){const d=await G.hasChatAccess("1",c.id.toString());r[c.id]=d}else r[c.id]=!0;y(r)})()},[]),i.useEffect(()=>{const s=new URLSearchParams(window.location.search),t=s.get("user"),r=s.get("room")||"private";if(p(r),t){const d=[...o,...u].find(A=>A.id.toString()===t);d&&(n(d),x(d.id))}},[f]);const o=[{id:1,name:"Anabella & Julio",image:"https://images.unsplash.com/photo-1551836022-d5d88e9218df?w=100&h=100&fit=crop&crop=faces",lastMessage:"¿Están libres este fin de semana? 🔥",timestamp:"5 min",isOnline:!0,unreadCount:2,isPrivate:!0,roomType:"private"},{id:2,name:"Sofía",image:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face",lastMessage:"Me encantó conocerlos en la fiesta 💕",timestamp:"1 h",isOnline:!0,unreadCount:0,isPrivate:!0,roomType:"private"},{id:3,name:"Carmen & Roberto",image:"https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?w=100&h=100&fit=crop&crop=faces",lastMessage:"¿Vienen al evento VIP del sábado?",timestamp:"3 h",isOnline:!1,unreadCount:0,isPrivate:!0,roomType:"private"},{id:4,name:"Raúl",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",lastMessage:"¿Qué tal si nos vemos para tomar algo?",timestamp:"2 h",isOnline:!1,unreadCount:1,isPrivate:!0,roomType:"private"}],u=[{id:101,name:"🔥 Sala General Lifestyle",image:"https://images.unsplash.com/photo-1573164713714-d95e436ab8d6?w=100&h=100&fit=crop&crop=face",lastMessage:"¡Bienvenidos a la comunidad swinger!",timestamp:"10 min",isOnline:!0,unreadCount:5,isPrivate:!1,roomType:"public"},{id:102,name:"💑 Parejas CDMX",image:"https://images.unsplash.com/photo-1551836022-d5d88e9218df?w=100&h=100&fit=crop&crop=faces",lastMessage:"Evento swinger este sábado en Polanco",timestamp:"30 min",isOnline:!0,unreadCount:12,isPrivate:!1,roomType:"public"},{id:103,name:"🌟 Singles Lifestyle",image:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face",lastMessage:"¿Alguien para intercambio hoy?",timestamp:"1 h",isOnline:!0,unreadCount:3,isPrivate:!1,roomType:"public"},{id:104,name:"🎭 Eventos Privados",image:"https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?w=100&h=100&fit=crop&crop=faces",lastMessage:"Club exclusivo abre sus puertas",timestamp:"2 h",isOnline:!0,unreadCount:8,isPrivate:!1,roomType:"public"}];i.useEffect(()=>{a&&x(a.id)},[a]);const C=()=>{if(!a||!h.trim())return;if(a.isPrivate&&!N[a.id]){alert("No tienes acceso a este chat privado. Necesitas una invitación aceptada.");return}if(!E(a)){alert("No puedes enviar mensajes a este usuario según su configuración de privacidad.");return}const t={id:Date.now()+Math.random(),senderId:0,content:h,timestamp:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),type:"text"};w(r=>[...r,t]),j("")},E=s=>{if(!S.messagingPrivacy||s.roomType==="public")return!0;switch(U.allowMessages){case"everyone":return!0;case"connections_only":return!0;case"none":return!1;default:return!0}};return e.jsxs("div",{className:"min-h-screen android-fix relative overflow-hidden bg-gradient-to-br from-purple-600 via-pink-500 to-indigo-600",children:[e.jsxs("div",{className:"fixed inset-0 z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600/90 via-pink-500/90 to-indigo-600/90"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-purple-400/20 via-pink-400/20 to-transparent"})]}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row h-screen chat-container",children:[e.jsx("div",{className:`${a?"hidden md:block":"block"} w-full md:w-1/3 bg-black/40 backdrop-blur-md border-r border-white/20`,children:e.jsxs("div",{className:"p-4 border-b border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-black/60 backdrop-blur-md border-b border-white/30 shadow-lg rounded-lg mb-4",children:[e.jsx(l,{variant:"ghost",onClick:()=>n(null),className:"text-white hover:bg-white/20 md:hidden p-2",children:e.jsx(g,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsxs("div",{className:"flex items-center justify-between flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white truncate",children:"Conversaciones"}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20 p-2",onClick:()=>v(-1),children:e.jsx(g,{className:"h-4 w-4"})})]})]}),e.jsxs(O,{value:f,onValueChange:s=>p(s),className:"w-full",children:[e.jsxs($,{className:"grid w-full grid-cols-2 bg-white/10 backdrop-blur-sm rounded-lg",children:[e.jsxs(k,{value:"private",className:"data-[state=active]:bg-white/20 data-[state=active]:text-white text-white/80 hover:text-white flex items-center gap-2 cursor-pointer rounded-md",onClick:()=>p("private"),children:[e.jsx(m,{className:"h-4 w-4"}),"Privado",o.reduce((s,t)=>s+t.unreadCount,0)>0&&e.jsx(M,{className:"bg-red-500 text-white text-xs",children:o.reduce((s,t)=>s+t.unreadCount,0)})]}),e.jsxs(k,{value:"public",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600/50 data-[state=active]:to-pink-600/50 data-[state=active]:text-white text-white hover:text-white flex items-center gap-2 cursor-pointer",onClick:()=>p("public"),children:[e.jsx(b,{className:"h-4 w-4"}),"Público",u.reduce((s,t)=>s+t.unreadCount,0)>0&&e.jsx(M,{className:"bg-red-500 text-white text-xs",children:u.reduce((s,t)=>s+t.unreadCount,0)})]})]}),e.jsxs(P,{value:"private",className:"mt-4",children:[e.jsx("div",{className:"text-white/70 text-sm mb-3 px-2",children:"💬 Chats privados con tus conexiones"}),e.jsx("div",{className:"space-y-2",children:o.map(s=>e.jsx("div",{onClick:()=>{n(s),x(s.id)},className:`p-3 rounded-lg cursor-pointer transition-all duration-200 ${a?.id===s.id?"bg-white/20 border border-white/30":"hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-12 h-12 rounded-full object-cover border-2 border-white/20"}),s.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-black/50"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-white truncate flex items-center gap-2",children:[s.name,e.jsx(m,{className:"h-3 w-3 text-purple-300"})]}),e.jsx("span",{className:"text-xs text-white/60",children:s.timestamp})]}),e.jsx("p",{className:"text-sm text-white/70 truncate",children:s.lastMessage})]}),s.unreadCount>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:s.unreadCount})]})},s.id))})]}),e.jsxs(P,{value:"public",className:"mt-4",children:[e.jsx("div",{className:"text-white/70 text-sm mb-3 px-2",children:"🌍 Salas públicas de la comunidad"}),e.jsx("div",{className:"space-y-2",children:u.map(s=>e.jsx("div",{onClick:()=>{n(s),x(s.id)},className:`p-3 rounded-lg cursor-pointer transition-all duration-200 ${a?.id===s.id?"bg-white/20 border border-white/30":"hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg border-2 border-white/20",children:s.name.charAt(0)}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-black/50"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-white truncate flex items-center gap-2",children:[s.name,e.jsx(b,{className:"h-3 w-3 text-green-300"})]}),e.jsx("span",{className:"text-xs text-white/60",children:s.timestamp})]}),e.jsx("p",{className:"text-sm text-white/70 truncate",children:s.lastMessage})]}),s.unreadCount>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:s.unreadCount})]})},s.id))})]})]})]})}),e.jsx("div",{className:`${a?"block":"hidden md:block"} flex-1 flex flex-col bg-black/20 backdrop-blur-sm`,children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-white/10 bg-black/30",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{variant:"ghost",size:"sm",className:"md:hidden text-white hover:bg-white/10 mr-2",onClick:()=>n(null),children:e.jsx(g,{className:"h-4 w-4"})}),a.roomType==="public"?e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold border-2 border-white/20",children:a.name.charAt(0)}):e.jsx("img",{src:a.image,alt:a.name,className:"w-10 h-10 rounded-full object-cover border-2 border-white/20"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-white",children:a.name}),a.roomType==="private"?e.jsx(m,{className:"h-4 w-4 text-purple-300"}):e.jsx(b,{className:"h-4 w-4 text-green-300"})]}),e.jsx("p",{className:"text-sm text-white/60",children:a.roomType==="public"?`Sala pública • ${Math.floor(Math.random()*50)+10} miembros activos`:a.isOnline?"En línea":`Última vez ${a.timestamp}`})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 chat-messages scroll-container",style:{scrollBehavior:"smooth"},children:T.map(s=>e.jsx("div",{className:`flex ${s.senderId===0?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] sm:max-w-xs lg:max-w-sm px-4 py-3 rounded-2xl break-words word-wrap ${s.senderId===0?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-white/95 text-gray-900 shadow-md border border-gray-200 backdrop-blur-sm"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed break-words whitespace-pre-wrap overflow-wrap-anywhere",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===0?"text-purple-100":"text-gray-500"}`,children:s.timestamp})]})},s.id))}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-black/30 chat-input",children:[a.isPrivate&&!N[a.id]?e.jsxs("div",{className:"text-center space-y-4 bg-black/50 rounded-lg p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-center text-white mb-3",children:[e.jsx(m,{className:"h-6 w-6 mr-2"}),e.jsx("span",{className:"font-semibold text-lg",children:"Chat privado bloqueado"})]}),e.jsxs("p",{className:"text-sm text-white/90 mb-6 leading-relaxed max-w-md mx-auto break-words whitespace-pre-wrap overflow-wrap-anywhere",children:["Necesitas una invitación aceptada para chatear con ",a.name,". Puedes enviar una invitación o esperar a que te envíen una."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(l,{onClick:()=>{console.log("Enviando invitación..."),y(s=>({...s,[a.id]:!0})),alert("¡Invitación aceptada! Ahora puedes chatear.")},className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Aceptar invitación"]}),e.jsx(l,{onClick:()=>{console.log("Rechazando invitación..."),n(null),alert("Invitación rechazada. Has vuelto a la lista de chats.")},variant:"outline",className:"border-red-300/50 text-red-300 hover:bg-red-500/20 px-6 py-2 rounded-lg font-medium transition-all duration-200",children:"Rechazar"})]})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(z,{value:h,onChange:s=>j(s.target.value),placeholder:"Escribe un mensaje...",className:"flex-1 bg-white/10 border-white/20 text-white placeholder-white/50 focus:border-purple-400 focus:ring-purple-400/20 rounded-lg",onKeyPress:s=>s.key==="Enter"&&C()}),e.jsx(l,{onClick:C,disabled:!h.trim(),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed px-4 py-2 rounded-lg transition-all duration-200",children:e.jsx(D,{className:"h-4 w-4"})})]}),a.roomType==="public"&&e.jsx("p",{className:"text-xs text-white/50 mt-2 px-1",children:"🔒 Los mensajes en salas públicas son visibles para todos los miembros"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white/60",children:[e.jsx(L,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Selecciona una conversación"}),e.jsx("p",{className:"mb-4",children:f==="private"?"Elige un chat privado para conversar de forma segura":"Únete a una sala pública para conocer la comunidad"}),e.jsxs("div",{className:"flex items-center justify-center text-sm space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"h-4 w-4 mr-1 text-purple-400"}),e.jsx("span",{children:"Chats privados encriptados"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-1 text-green-400"}),e.jsx("span",{children:"Salas públicas moderadas"})]})]})]})})})]}),e.jsx(R,{}),e.jsx("style",{children:`
        @keyframes blob {
          0%, 100% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(30px, -50px) scale(1.1); }
          66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        
        .animate-blob {
          animation: blob 7s infinite;
        }
        
        .animation-delay-2000 {
          animation-delay: 2s;
        }
        
        .animation-delay-4000 {
          animation-delay: 4s;
        }
      `})]})};export{X as default};
